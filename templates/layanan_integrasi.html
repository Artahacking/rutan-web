{% extends "layout.html" %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<style>
    /* Style untuk merapikan teks */
    .service-content ul, .service-content ol { margin-left: 20px; padding-left: 20px; margin-bottom: 1rem; }
    .service-content li { margin-bottom: 5px; }
    .service-content p { margin-bottom: 10px; line-height: 1.6; text-align: justify; }

    /* Style Gambar Thumbnail */
    .img-clickable {
        cursor: pointer;
        transition: transform 0.2s;
        border: 2px solid #dee2e6;
    }
    .img-clickable:hover {
        transform: scale(1.02);
        border-color: #0d6efd;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    /* Tombol Close Custom Besar Merah */
    .btn-close-force {
        background-color: #dc3545; /* Merah */
        opacity: 1;
        width: 40px; 
        height: 40px;
        border-radius: 50%;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath d='M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z'/%3e%3c/svg%3e");
        background-position: center;
        background-repeat: no-repeat;
        background-size: 1rem;
        border: 2px solid white;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        cursor: pointer;
        z-index: 1060; 
        transition: all 0.3s ease;
    }
    .btn-close-force:hover { 
        background-color: #a71d2a; 
        transform: scale(1.1) rotate(90deg); 
    }

    #modalManual { z-index: 1055 !important; }
    #backdropManual { z-index: 1050 !important; background-color: rgba(0, 0, 0, 0.7); }
</style>

<div class="container my-5">
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="text-center mb-5">
        <h2 class="fw-bold">Layanan Rutan Kelas IIB Pangkalan Brandan</h2>
        <hr class="mx-auto" style="width: 100px; height: 3px; background-color: #0d6efd; opacity: 1;">
    </div>

    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm border-0 bg-light">
                <div class="card-header bg-warning text-dark fw-bold d-flex align-items-center">
                    <i class="bi bi-info-circle-fill me-2 fs-5"></i>
                    <span>Panduan Pengisian Data Surat Jaminan</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8 mb-3 mb-md-0">
                            <h5 class="fw-bold text-primary">Contoh Format Pengisian</h5>
                            <p class="mb-2">Silakan lihat contoh di samping agar tidak terjadi kesalahan pengisian data.</p>
                            <div class="alert alert-light border shadow-sm">
                                <small class="fw-bold d-block mb-1 text-danger">*Poin Penting:</small>
                                <ul class="mb-0 small text-muted ps-3">
                                    <li><strong>Yang bertanda tangan:</strong> Diisi data KELUARGA/PENJAMIN.</li>
                                    <li><strong>Penjamin dari:</strong> Diisi data WARGA BINAAN (Napi).</li>
                                </ul>
                            </div>
                            <p class="small text-muted mb-0"><i class="bi bi-hand-index-thumb"></i> Klik gambar di samping untuk memperbesar.</p>
                        </div>
                        <div class="col-md-4 text-center">
                            <img src="{{ url_for('static', filename='image.png') }}" 
                                 alt="Klik untuk memperbesar" 
                                 class="img-fluid rounded img-clickable" 
                                 style="max-height: 200px;"
                                 onclick="bukaModalPaksa()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-8 mx-auto">
            <div class="card shadow border-primary border-2">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-cloud-upload-fill me-2"></i> Form Upload Surat Jaminan</h5>
                </div>
                <div class="card-body p-4">
                    <form action="{{ url_for('upload_surat_jaminan') }}" method="POST" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Nama Pengirim (Penjamin)</label>
                            <input type="text" name="nama" class="form-control" placeholder="Masukkan nama sesuai KTP" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">NIK KTP</label>
                                <input type="number" name="nik" class="form-control" placeholder="16 digit NIK" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Nomor WhatsApp</label>
                                <input type="text" name="no_wa" class="form-control" placeholder="Contoh: 08123456789" required>
                                <small class="text-muted">Nomor ini akan digunakan petugas untuk konfirmasi.</small>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold">Upload Berkas Surat Jaminan</label>
                            <input type="file" name="file_surat" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" required>
                            <small class="text-danger">*Format: PDF, Word, atau Foto yang jelas.</small>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary fw-bold py-2">
                                <i class="bi bi-send-fill me-2"></i> KIRIM SURAT JAMINAN
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalManual" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" style="background-color: #ffffff !important; border: none;">
                <div class="modal-header border-bottom-0" style="background-color: #ffffff !important; position: sticky; top: 0; z-index: 1020;">
                    <h5 class="modal-title fw-bold text-dark">
                        <i class="bi bi-file-earmark-text text-primary"></i> Detail Contoh Pengisian
                    </h5>
                    <button type="button" class="btn-close-force" onclick="tutupModalPaksa()" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-0" style="background-color: #ffffff !important;">
                    <img src="{{ url_for('static', filename='image.png') }}" 
                         class="img-fluid" 
                         style="width: 100%; cursor: pointer;" 
                         alt="Contoh Surat Jaminan Full"
                         onclick="tutupModalPaksa()">
                </div>
                <div class="modal-footer border-top-0" style="background-color: #ffffff !important;">
                    <button type="button" class="btn btn-danger px-5 py-2 fw-bold" onclick="tutupModalPaksa()">TUTUP</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        {% for serv in services %}
        <div class="col-12 mb-5">
            <div class="shadow rounded overflow-hidden border-0">
                <div class="p-3 text-white d-flex align-items-center" style="background-color: #1b6ec2;">
                    <i class="bi bi-geo-alt-fill me-2 fs-4"></i>
                    <h4 class="m-0 fw-bold">{{ serv.title }}</h4>
                </div>
                <div class="bg-white p-4 service-content">
                    {{ serv.description | safe }}
                    {% if serv.file %}
                    <div class="mt-4 pt-3 border-top">
                        <a href="{{ url_for('static', filename='uploads/' + serv.file) }}" target="_blank" class="btn btn-danger">
                            <i class="bi bi-file-earmark-pdf-fill"></i> Download Surat Jaminan (PDF)
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% else %}
        {% endfor %}
    </div>
</div>

<script>
    function bukaModalPaksa() {
        var modal = document.getElementById('modalManual');
        modal.style.display = 'block';
        setTimeout(function() { modal.classList.add('show'); }, 10);
        modal.setAttribute('aria-modal', 'true');
        modal.removeAttribute('aria-hidden');
        var backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop fade show';
        backdrop.id = 'backdropManual';
        backdrop.onclick = function() { tutupModalPaksa(); };
        document.body.appendChild(backdrop);
        document.body.classList.add('modal-open');
    }

    function tutupModalPaksa() {
        var modal = document.getElementById('modalManual');
        var backdrop = document.getElementById('backdropManual');
        modal.classList.remove('show');
        setTimeout(function() { modal.style.display = 'none'; }, 150);
        modal.removeAttribute('aria-modal');
        modal.setAttribute('aria-hidden', 'true');
        if (backdrop) {
            backdrop.classList.remove('show');
            setTimeout(function() {
                if(backdrop.parentNode) { backdrop.parentNode.removeChild(backdrop); }
            }, 150);
        }
        document.body.classList.remove('modal-open');
        document.body.style.overflow = ''; 
    }
</script>
{% endblock %}